<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Edit Campaign</title>
  <style>
    .hidden { display: none; }
    .status { margin-top: 1em; color: #333; }
  </style>
</head>
<body>
  <h2>Edit Campaign</h2>
  <div class="status" id="statusText">ğŸ” Loadingâ€¦</div>

  <form id="editForm" class="hidden">
    <label>App Name: <input type="text" id="offer"/></label><br/>
    <label>Offer ID: <input type="text" id="id" readonly/></label><br/>
    <label>User Payout â‚¹: <input type="number" id="User"/></label><br/>
    <label>Refer Payout â‚¹: <input type="number" id="refer"/></label><br/>
    <label>Status:
      <select id="status">
        <option value="">--</option>
        <option value="active">active</option>
        <option value="over">over</option>
      </select>
    </label><br/>
    <label>Payment:
      <select id="payment">
        <option value="">--</option>
        <option value="Instant">Instant</option>
        <option value="3hours">3hours</option>
        <option value="24hours">24hours</option>
        <option value="48hours">48hours</option>
        <option value="72hours">72hours</option>
      </select>
    </label><br/>
    <label>Description:<br/>
      <textarea id="description" rows="4" cols="40"></textarea>
    </label><button type="button" onclick="addNewLine()">Add line</button><br/>
    <label>Tracking link:<br/>
      <input type="url" id="tracking_link" style="width: 400px;"/>
    </label><br/>
    <button type="submit">Save</button>
  </form>

<script>
  const statusText = document.getElementById('statusText');
  const form = document.getElementById('editForm');
  const params = new URLSearchParams(location.search);
  const offerId = params.get('o');
  console.log('URL param o=', offerId);
  if (!offerId) {
    statusText.textContent = 'âŒ No ?o=... in URL. You must use ?o=28 etc.';
  } else {
    statusText.textContent = 'ğŸ” Fetching offers.jsonâ€¦';
    fetch('https://groww-social.github.io/camps/offers.json').then(res=>{
      console.log('offers.json status', res.status);
      return res.json();
    }).then(data => {
      console.log('offers.json data', data);
      if (!Array.isArray(data)) {
        statusText.textContent = 'âŒ offers.json didn\'t return an array.';
        return;
      }
      const campaign = data.find(c=>c.id === offerId || c.id === Number(offerId));
      console.log('matched campaign', campaign);
      if (!campaign) {
        statusText.textContent = âŒ No campaign with id = ${offerId};
        return;
      }

      // Populate form
      form.off("display", "");
      form.classList.remove('hidden');
      statusText.textContent = âœ… Editing campaign id=${offerId};
      document.getElementById('offer').value = campaign.offer || '';
      document.getElementById('id').value = campaign.id || '';
      document.getElementById('User').value = campaign.User || '';
      document.getElementById('refer').value = campaign.refer || '';
      document.getElementById('status').value = campaign.status || '';
      document.getElementById('payment').value = campaign.payment || '';
      document.getElementById('description').value = campaign.description || '';
      document.getElementById('tracking_link').value = campaign.tracking_link || '';
    }).catch(err => {
      console.error(err);
      statusText.textContent = 'âŒ Error fetching or parsing offers.json (check console)';
    });
  }

  function addNewLine() {
    document.getElementById('description').value += '\n';
    document.getElementById('description').focus();
  }

  form.addEventListener('submit', e => {
    e.preventDefault();
    alert('Save functionality not wired yetâ€”debug completed.');
  });
</script>
</body>
</html>
