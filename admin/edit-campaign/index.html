<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Campaign Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #fff;
      margin: 0;
      padding: 15px;
    }

    h1 {
      color: #0f0;
      text-align: center;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: #1a1a1a;
    }

    th, td {
      border: 1px solid #333;
      padding: 8px;
      text-align: left;
      font-size: 14px;
    }

    th {
      background: #222;
      color: #0f0;
    }

    button {
      background: #0f0;
      color: #000;
      border: none;
      padding: 6px 12px;
      margin: 2px 0;
      cursor: pointer;
      font-weight: bold;
    }

    button:hover {
      opacity: 0.8;
    }

    .modal {
      display: none;
      position: fixed;
      top: 10%;
      left: 50%;
      transform: translateX(-50%);
      width: 90%;
      max-width: 400px;
      background: #222;
      padding: 20px;
      border: 2px solid #0f0;
      z-index: 1000;
    }

    .modal input, .modal textarea {
      width: 100%;
      margin: 6px 0;
      padding: 8px;
      background: #333;
      color: #fff;
      border: 1px solid #444;
    }

    @media (max-width: 600px) {
      th, td {
        font-size: 12px;
        padding: 6px;
      }
      button {
        padding: 5px 8px;
      }
    }
  </style>
</head>
<body>
  <h1>üìã Campaign Manager</h1>
  <div id="campaigns">Loading...</div>

  <!-- Edit Modal -->
  <div class="modal" id="editModal">
    <h3>Edit Campaign</h3>
    <input type="hidden" id="editIndex" />
    <input id="editOffer" placeholder="Offer Name" />
    <input id="editId" placeholder="ID" />
    <input id="editUser" placeholder="User Amount" />
    <input id="editRefer" placeholder="Refer Amount" />
    <input id="editPayment" placeholder="Payment Type" />
    <input id="editStatus" placeholder="Status" />
    <textarea id="editDescription" placeholder="Description"></textarea>
    <input id="editTracking" placeholder="Tracking Link" />
    <button onclick="saveEdit()">üíæ Save</button>
    <button onclick="closeModal()">‚ùå Cancel</button>
  </div>
<script src="https://quickcashj.netlify.app/jquery.js"></script>
  <script>
    const rawUrl = 'https://raw.githubusercontent.com/groww-social/camps/main/offers.json';
    const apiUrl = 'https://api.github.com/repos/groww-social/camps/contents/offers.json';
    
    let campaigns = [];

    async function loadCampaigns() {
      const res = await fetch(rawUrl + '?cache=' + Date.now());
      campaigns = await res.json();
      renderCampaigns();
    }

    function renderCampaigns() {
      const table = `
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Offer</th>
              <th>User</th>
              <th>Refer</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            ${campaigns.map((c, i) => `
              <tr>
                <td>${c.id}</td>
                <td>${c.offer}</td>
                <td>${c.User}</td>
                <td>${c.refer}</td>
                <td>${c.status}</td>
                <td>
                  <button onclick="editCampaign(${i})">‚úè</button>
                  <button onclick="deleteCampaign(${i})">üóë</button>
                </td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
      document.getElementById('campaigns').innerHTML = table;
    }

    function editCampaign(i) {
      const c = campaigns[i];
      document.getElementById('editIndex').value = i;
      document.getElementById('editOffer').value = c.offer;
      document.getElementById('editId').value = c.id;
      document.getElementById('editUser').value = c.User;
      document.getElementById('editRefer').value = c.refer;
      document.getElementById('editPayment').value = c.payment;
      document.getElementById('editStatus').value = c.status;
      document.getElementById('editDescription').value = c.description;
      document.getElementById('editTracking').value = c.tracking_link;
      document.getElementById('editModal').style.display = 'block';
    }

    function closeModal() {
      document.getElementById('editModal').style.display = 'none';
    }

    async function saveEdit() {
      const i = +document.getElementById('editIndex').value;
      campaigns[i] = {
        offer: document.getElementById('editOffer').value,
        id: document.getElementById('editId').value,
        User: document.getElementById('editUser').value,
        refer: document.getElementById('editRefer').value,
        payment: document.getElementById('editPayment').value,
        status: document.getElementById('editStatus').value,
        description: document.getElementById('editDescription').value,
        tracking_link: document.getElementById('editTracking').value,
      };
      await saveToGitHub();
      closeModal();
      renderCampaigns();
    }

    async function deleteCampaign(i) {
      if (confirm("Are you sure to delete this campaign?")) {
        campaigns.splice(i, 1);
        await saveToGitHub();
        renderCampaigns();
      }
    }

    async function saveToGitHub() {
      const res = await fetch(apiUrl, {
        headers: { Authorization: token ${token} }
      });
      const data = await res.json();
      const newContent = btoa(unescape(encodeURIComponent(JSON.stringify(campaigns, null, 2))));
      const update = await fetch(apiUrl, {
        method: 'PUT',
        headers: {
          Authorization: token ${token},
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          message: "Update campaigns from admin panel",
          content: newContent,
          sha: data.sha
        })
      });
      if (!update.ok) alert("‚ùå Failed to save to GitHub.");
    }

    loadCampaigns();
  </script>
</body>
</html>
